# nodejsws

nodejsws是基于nodejs的一个企业在线办公管理系统。它基于B/S和C/S混合模式设计。WEB后台采用多进程模式运行,其中,主进程负责提供HTTP服务，子进程一负责提供websocket服务，子进程二负责处理平台定时任务.进程之间采用命名管道进行IPC通讯。

系统主要实现用户及用户权限管理，企业服务器及服务器上的应用程序管理，以及用户工作所产生的文楼数据管理等功能。

系统后端主要采用 nodejs 的 express 框架，前端主要采用 javascript/html5/css + jquery + bootstrap 实现。另外，系统在后台通过TCP常连接，实现与C++服务器的双向数据交换，以及通过websocket实现前端和后台的实时双向数据交换。



### 项目介绍

#### 项目目录

- bin：可执行文件 www 所在目录，同时配置文件 config.xml 也在此目录下，主要配置数据库信息。
- common：封装了一些通用操作，供nodejs后端调用。
- database：封装了mysql数据库操作功能，供nodejs后端调用。
- public：所有前端页面代码都放在此目录下。
- routes：路由配置目录，其中所有的路由配置信息都放在 router.js 文件中。
- views：此目录为默认的页面目录，此项目中没有什么用。



##### 重要目录及文件说明：

- bin/www文件：此文件为包含HTTP服务启动代码，如果要修改HTTP服务创建的方式或端口则到此文件修改，目前端口号支持从config.xml配置文件修改。
- public：WEB前端页面。
- public/cfg：系统配置相关功能页面。
- public/log：系统日志管理页面。
- public/manage：系统资源管理相关功能页面（包括用户管理，服务器主机管理，服务器上的应用程序管理，以及用户权限管理等）。
- public/mon：监控相关功能页面。
- public/statis：统计相关功能页面。
- router：WEB服务后端路由及各种控制器目录。
- router/cfg：系统设置控制器，与前端public/cfg相对应。
- router/child：子进程模块，用于创建、管理及调试子进程。
- router/log：系统日志控制器，与前端public/log相对应。
- router/manage：系统最重要的控制器，包含对用户、服务器主机、主机上的应用程序等各种资源的管理子控制器。
- router/mon：系统监控相关的控制器。
- router/net：后台网络基础封装模块，包括TCP客房端，websocket服务，以及数据包数据的封装等。
- router/statis：统计控制器。



#### 项目技术设计

系统采用多服务多进程架构，主进程用于提供HTTP服务，以及管理子进程。

child_proc_cc进程用于提供websocket服务，同时内部会管理一个TCP连接用于和CC服务器进行通讯。

child_proc_sch进程用于执行系统各种定时任务。

主进程会创建一个websocket客房端，与child_proc_cc进程的websocket服务端保持长连接，当web客户端向主进程发起请求时，如果需要其它数据，就会向websocket服务器端发请求，以获取所需数据，再返回给客户端。

child_proc_cc进程中的TCP与CC服务器之间采用二进制流的方式进行数据传输，这里主要采用NodeJS的Buffer模块进行封装，具体操作放在net模块中。



#### 项目功能

##### 普通用户功能

系统会给普通用户提供一个类似于Windows7的桌面，上面会有被授权的应用程序图标，用户只需要双击鼠标左键，就可以运行相应的应用程序。



##### 管理员功能

**系统资源管理：**用户及权限管理，服务器主机管理，服务器上的应用及权限管理等。

**监控管理：**用户监控（比如是否在线、正在使用哪些应用程序等），服务器主机监控（比如是否在线、CPU使用率、内在使用率、有多少人在用等），应用程序监控（有多少个应用在使用、应用开了多少个进程等）等。

**统计管理：**用户统计（周期内登录次数、使用应用个数、以及运行的应用进程数等），服务器主机统计（上线多少次、下线多少次等），应用程序统计（有多少人使用、被使用多少次等）等。

**日志管理：**对使用系统的各种记录信息进行管理。

**系统设置：**对系统运行参数进行设置，比如服务端口号、用户登录超时时间、监控数据采集频率等。



### 技术栈

**数据库：**mysql

**后端：**nodejs + express 

**前端：**javascript + html5 + css3 + jquery + bootstrap



### 编译运行

#### 编译环境:

node 版本大于等于 8.11.2 

mysql 版本大于等于 5.5



#### 编译运行:

- 创建appcloud数据库,并导入 doc/appcloud-tb-init-v.2.4.sql 文件
- 解压项目文件夹
- 修改bin/config.xml中的数据库配置信息
- 管理员模式打开CMD命令行,并定位到项目目录
- npm install --save
- npm start
- 测试:浏览器输入 http://localhost ,默认管理员账号: admin 密码: 123456



